<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gyoza Feast! - 祝・入籍ギフト【最終完全体】</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: #ff4d4d; margin: 0; font-family: sans-serif; overflow-x: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 12px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 20px; border: 3px solid black; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #ff4d4d; border-radius: 20px; border: 3px solid black; }
        @keyframes zoom-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-in { animation: zoom-in 0.3s ease-out forwards; }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 10s linear infinite; }
        @keyframes delivery-run { 0% { left: -220px; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { left: 100%; opacity: 0; } }
        .animate-delivery-run { position: absolute; left: -220px; animation: delivery-run 6s linear infinite; }
        button:disabled { opacity: 0.2; cursor: not-allowed; filter: grayscale(1); pointer-events: none; }
    </style>
</head>
<body class="pb-48">

    <div id="raimon-container" class="flex overflow-hidden opacity-30 py-2 select-none bg-black/5"></div>
    <div id="app-content"></div>

    <script>
        // ==========================================
        // 【管理者設定】
        // ==========================================
        let ORDER_COMPLETED = false; // trueにすると配送状況・履歴ページになります
        const ORDER_STATUS = 'shipping'; 
        const DELIVERY_MAN_IMAGE = "https://otona2020.itembox.design/product/022/000000002208/000000002208-01-l.jpg?t=20260116095203"; 
        const COMPLETED_MESSAGE = "全国の餃子職人たちが、順次発送の準備を進めているあるよ！";
        const DELIVERY_ESTIMATE = "2月上旬頃に到着予定！";

        // 予算設定
        const ACTUAL_LIMIT = 16000; // 160GP(16,000円)を絶対上限に設定

        // 14種類の全データ
        const GYOZA_DATA = [
            { id: 7, name: "北海道の至宝！『天のびろく』極上3種食べ比べ・道産素材の共演セット", region: "北海道地方", prefecture: "北海道", description: "千歳発！道産小麦100%のモチモチ皮と, ブランド肉『夢の大地』の旨味。プレミアム・オリジナル・とかちマッシュの3種を一度に。", longDescription: "北海道千歳市で「本当に美味しい餃子を」という想いから生まれた『天のびろく』。最大の特徴は、北海道産の小麦粉を独自にブレンドした、驚くほど弾力のある皮。餡には十勝のブランド豚『夢の大地』を贅沢に使用し、溢れ出る肉汁はまさに絶品。十勝産マッシュルームが香る「とかちマッシュ」を含む、北の大地の恵みを一箱に詰め合わせた贅沢なセットです。", cooking: "多めの差し水で皮をじっくり蒸し上げ、仕上げに油で底面を焼き固めることで、皮の『モチッ』と『カリッ』の対比が際立ちます！", pairing: "冷えた十勝ワイン、または濃厚なコーン茶 🌽", sauce: "まずはそのまま、皮の甘みを感じて。次に岩塩で肉の旨味を引き立てるのが店主のオススメ！", price: 4580, count: 36, tags: ["千歳名物", "夢の大地豚"], color: "bg-blue-50", icon: "🌾", image: "https://www.otoriyose.net/upload/item/62/00006247/344317321b981a9.jpg?ts=1670485425" },
            { id: 8, name: "中毒性注意！『ぎょうざの宝永』とろ〜り3種ブレンド・魔法のチーズ餃子", region: "北海道地方", prefecture: "北海道", description: "北海道音更町発。パンチの効いた宝永餡に、特製さいころチーズがゴロゴロ！一度食べたら忘れられない『宝永ファン』急増中の名品。", longDescription: "音更町での創業以来、強烈なパンチと旨味で全国にファンを持つ『宝永』が贈る究極のチーズ餃子。餡の中に上質な3種類のチーズを贅沢にブレンド。さらに中央に「さいころ状のチーズ」を入れることで、焼き上がりから溢れ出す『とろ〜り感』を極限まで追求しました。チーズのコクと、ガツンと効いたニンニクが最高の相性を誇る、まさに悪魔的な美味しさです。", cooking: "チーズが溶け出さないよう、焼き上がりは手早く！フライパンからお皿へ移す瞬間が、チーズが一番輝く瞬間です。", pairing: "強炭酸のハイボール、または濃厚なミルク 🥃", sauce: "何もつけずにそのまま！または黒胡椒をたっぷりかけて。お好みでハチミツを少し垂らすと新世界が開けます。", price: 2680, count: 15, tags: ["音更発祥", "濃厚チーズ"], color: "bg-yellow-50", icon: "🧀", image: "https://www.otoriyose.net/upload/item/48/00004831/dfa372bd6d1f264.jpg?ts=1472520632" },
            { id: 9, name: "岩手の恵み！『粉夢』とろシャキ食感！しんいちろう餃子（ねばり）", region: "東北地方", prefecture: "岩手", description: "岩手町特産の『ねばり芋』が餡に！とろ〜り＆シャキシャキの驚き食感。にんにく不使用で、いつでも楽しめる麺屋の本格皮餃子。", longDescription: "岩手県岩手町の豊かな農産物を詰め込んだ特製餃子。主役はなんといっても高級種『ねばり芋』。加熱することで生まれる「とろ〜っ」とした滑らかさと、絶妙に残る「シャキシャキッ」とした食感のコントラストが唯一無二の体験。麺屋としての技術を注ぎ込んだ自家製の「もちもち皮」が、やまと豚の旨味をしっかり閉じ込めます。", cooking: "まずは水餃子で『とろシャキ』感をダイレクトに味わうのがおすすめ！焼きなら、皮のパリッと感と餡の滑らかさが楽しめます。", pairing: "キリッと冷えた日本酒、または地元のリンゴジュース 🍎", sauce: "にんにく不使用なので、醤油と少しの辣油でシンプルに。", price: 2080, count: 24, tags: ["岩手名物", "ねばり芋使用"], color: "bg-emerald-50", icon: "🍠", image: "https://www.otoriyose.net/upload/item/91/00009103/396685c4d01894d.jpg?ts=1648111443" },
            { id: 10, name: "情熱の紅白！『餃子の餃天』ハレの日を彩る・無添加モチモチ紅白餃子セット", region: "東北地方", prefecture: "秋田", description: "秋田発, 見た目も華やかな紅白の贈り物。化学調味料不使用, 素材の力だけで引き出した圧倒的な旨味と美しさを新生活のお祝いに。", longDescription: "秋田で絶大な支持を得る『餃天』。慶事にふさわしい「紅白」の皮は、厳選された国産素材のみを使用し、無添加にこだわり抜いています。赤は唐辛子を練り込みつつも辛すぎず、食欲をそそる香ばしさが特徴。熟成された皮の「驚異的な弾力」と、溢れ出すジューシーな肉汁は、一度食べたら忘れられない衝撃。入籍祝いに最もふさわしい、美しき実力派です。", cooking: "紅白を交互に並べて焼くと、食卓が一気におめでたい雰囲気に！差し水は少し多めにするのが、皮のモチモチ感を育てる秘訣です。", pairing: "シャンパン、または秋田の銘酒 🍶", sauce: "タレなしで皮の甘みを感じて。次に大根おろしポン酢で爽やかに。", price: 3796, count: 24, tags: ["秋田の名店", "紅白でお祝い"], color: "bg-red-100", icon: "㊗️", image: "https://www.otoriyose.net/upload/item/53/00005393/6683c2dd7910821.jpg?ts=1491353977" },
            { id: 3, name: "浦和の至宝！『うらわ餃子』3種バラエティ・欲張り全味制覇セット", region: "関東地方", prefecture: "埼玉", description: "埼玉・浦和発！野菜の旨味が主役の『無添加・手作り』。定番・しそ・旨辛、全部入った初回限定の大満足パック。", longDescription: "浦和の住宅街で話題沸騰、並んでも買いたいと評判の「うらわ餃子」。最大の特徴は、化学調味料不使用で毎日食べても飽きない優しい味わい. 不動の人気『レギュラー』、爽やかな香りが広がる『しそ』、自家製辣油がピリリと効いた『旨辛』の3種類を一気に楽しめる贅沢なセットです。", cooking: "冷凍のまま多めの差し水で蒸し焼きに。仕上げに油を回しかけてパリッとさせるのが浦和流のコツです！", pairing: "麦茶、または炊き立ての白米のお供に 🍚", sauce: "レギュラーには酢胡椒、しそには lemont と塩がベストマッチ！", price: 5123, count: 30, tags: ["浦和名物", "無添加"], color: "bg-green-50", icon: "🥬", image: "https://imagedelivery.net/QondspN4HIUvB_R16-ddAQ/6020a530c19c45763fd7f2e3/f1c45bb3a91a8e34727a.jpeg/fit=cover,w=920,h=920" },
            { id: 11, name: "宇都宮の真髄！『和の中』皮から手作り・医食同源の極み薬膳餃子", region: "関東地方", prefecture: "栃木", description: "宇都宮の人気店。熟練の職人が皮から一枚ずつ手作り。身体に染み渡る薬膳の香りと, モチモチ食感が魂を揺さぶる一品。", longDescription: "餃子の聖地・宇都宮において、独自の輝きを放つ『和の中』。最大の特徴は、注文を受けてから延ばすほどこだわった「皮」。冷凍でお届けするセットでも、その圧倒的な存在感と弾力は健在です. 餡には数種類のスパイスが調合された「薬膳」のエッセンスが。身体の内側から温まる、健康を願う贈り物にぴったりの餃子です。", cooking: "焼き餃子も絶品ですが、ぜひ『水餃子』でお召し上がりください。皮の本当の美味しさが際立ちます。", pairing: "中国茶、または滋味深い温かいスープ 🍲", sauce: "店主推奨は、黒酢に生姜をたっぷりと。薬膳の香りがより華やかになります。", price: 2550, count: 30, tags: ["宇都宮餃子", "皮が主役"], color: "bg-slate-50", icon: "sparkles", image: "https://www.otoriyose.net/upload/item/62/00006270/dacab781bd14b4e.jpg?ts=1538043509" },
            { id: 14, name: "石川の巨星！『餃子専門店ぽう』食べ応えMAX！大きな餃子人気3種セット", region: "北陸地方", prefecture: "石川", description: "1個が通常の約2倍！圧倒的なボリュームと, プレーン・生姜・梅の絶妙な三連星。化学調味料不使用で素材の味が活きる逸品。", longDescription: "石川県能美市で愛される、大きな餃子が自慢の専門店『ぽう』。一つひとつ丁寧に手包みされた餃子は、溢れ出る肉汁と野菜の甘みが広がります。大満足のサイズ感ながら、無添加なので後味はスッキリ。お腹も心も満たされる、まさに「ご馳走」と呼ぶにふさわしいセットです。", cooking: "大きめサイズなので、蒸し時間を少し長めに取るのがポイント。焼き上がり直前に強火で一気にパリッとさせれば、最高の食感になります！", pairing: "炭酸水、または石川の地酒 🍶", sauce: "梅餃子にはそのまま。生姜餃子には酢胡椒が相性抜群です。", price: 4880, count: 36, tags: ["石川・能美", "ジャンボ"], color: "bg-orange-50", icon: "award", image: "https://otona2020.itembox.design/product/022/000000002208/000000002208-01-l.jpg?t=20260116095203" },
            { id: 6, name: "富山の至宝！『ミッちゃん餃子』モチパリ薄皮・新鮮野菜たっぷりお試しセット", region: "北陸地方", prefecture: "富山", description: "富山で30年以上愛される行列店。野菜の甘みと生姜の香りが弾ける！ニンニク控えめで毎日食べたい優しい味わい。", longDescription: "富山県で不動の人気を誇る『ミッちゃん餃子』。一番のこだわりは、機械を使わず仕上げる独自の『薄皮』。焼けばパリッと、茹でればモチッとする驚きの食感が楽しめます。隠し味の生姜が爽やかに香り、添加物不使用の安心感も魅力. 富山の家庭の味を支える、愛情たっぷりの手作り餃子をお届けします。", cooking: "多めの差し水でしっかり蒸し上げ、最後に強火で一気に水分を飛ばして焼き色をつけるのが、モチパリ食感を引き出すコツです！", pairing: "冷えた白ワイン、または熱々の日本茶 🍵", sauce: "まずはそのまま、素材の甘みを楽しんで. 次に付属の特製タレをつけて召し上がれ！", price: 3400, count: 24, tags: ["富山名物", "野菜たっぷり"], color: "bg-yellow-100", icon: "smile", image: "https://www.otoriyose.net/upload/item/115/00011548/3f2310173c78c50.jpg?ts=1719195729" },
            { id: 5, name: "大阪の超新星！『餃子専門店チャンピオン』パクパク止まらない！黄金のひとくち餃子セット", region: "近畿地方", prefecture: "大阪", description: "大阪・今里で行列必至の人気店. サクふわ食感の極み, 鶏肉と季節のキャベツが奏でる究極のハーモニー。", longDescription: "大阪・今里の餃子激戦区で多くのファンを虜にする『チャンピオン』。最大の特徴は、季節ごとに工程を微調整した甘みたっぷりのキャベツ。あっさりとしつつもコクのある国産鶏肉を使用し、小さめサイズにギュッと旨味を凝縮。一度食べ始めたら最後、お皿が空になるまで手が止まらない「魔力」を秘めたひとくち餃子です。", cooking: "強火で一気に焼き上げるのが正解。小さめなので、焼き時間は短めで皮のパリッと感を最大限に引き出してください！", pairing: "焼酎のソーダ割り、または烏龍茶 🍵", sauce: "焼きはタレなし、または酢胡椒. 水餃子にするなら「塩」だけで素材の甘みを引き立てて。", price: 2750, count: 35, tags: ["大阪・今里", "ひとくち"], color: "bg-red-50", icon: "trophy", image: "https://cdn.shopify.com/s/files/1/0622/4239/0147/files/IMG_2845.jpg?v=1739506998" },
            { id: 12, name: "伊勢の伝説！『ぎょうざの美鈴』創業昭和38年・一枚一枚手で延ばす究極の手延べ餃子", region: "近畿地方", prefecture: "三重", description: "伊勢神宮近くの超有名店。機械に頼らず, 一枚ずつ皮を延ばし包み上げる職人の技。地元たまり醤油を使った秘伝タレで味わう至高の体験。", longDescription: "昭和38年の創業以来、伊勢で愛される『美鈴』。その美味しさの源は、徹底した「手作業」にあります。注文を受けてから皮を延ばすお店の流儀を、冷凍餃子でも再現。焼けばパリッ、食べればモチッ。伊勢の誇りを感じる、伝統と情熱の詰まった手延べ餃子をお届けします。", cooking: "仕上げに油を多めに使い、揚げ焼きのようにすることで皮の『パリッ』と感が最大限に引き立ちます。付属のタレは必ず常温に戻してから！", pairing: "伊勢の地ビール、または深みのある緑茶 🍵", sauce: "付属の『特製たまり醤油ダレ』が絶対条件。この深いコクこそが美鈴です。", price: 1900, count: 12, tags: ["伊勢の行列店", "手延べ皮"], color: "bg-amber-50", icon: "flame", image: "https://image1.shopserve.jp/gyouzanomisuzu-online.com/pic-labo/llimg/t0004_02.gif?t=20230327162702" },
            { id: 1, name: "ミシュランの伝説！岡山「山東水餃大王」水餃子3種極みセット", region: "中国地方", prefecture: "岡山", description: "ビブグルマン掲載！岡山・日生のレジェンド店。厚さ1mmの限界を超えたモチモチ食感に溺れる。", longDescription: "岡山県日生町で40年以上愛され、ミシュランガイドにも掲載された伝説の名店。特級点心師の技が光る「厚さ」にこだわった皮は、一度食べたら忘れられない圧倒的な弾力です。特に同封の「特製タレ」は豆豉（トウチ）のコクと香りが絶妙な至高の逸品です。", cooking: "たっぷりのお湯で茹でるだけ。浮き上がってからさらに1分待つのが「究極のモチモチ」を引き出す店主直伝の秘訣！", pairing: "紹興酒、またはキンキンに冷えた中国茶 🍵", sauce: "付属の「秘伝・豆豉（トウチ）タレ」一択。これ以外考えられません。", price: 6310, count: 40, tags: ["ミシュラン掲載", "究極のモチモチ"], color: "bg-blue-50", icon: "star", image: "https://santon-suigyo-daio.com/wp-content/uploads/2022/11/FC_20221107_0004.jpg" },
            { id: 4, name: "下関の至芸！『餃子屋はまだ』職人手包み・4種バラエティ食べ比べ極セット", region: "中国地方", prefecture: "山口", description: "山口・下関の名店. マーボー・大葉・生姜・にんにくの全4味を、熟練の職人が一粒ずつ丁寧に手包み。", longDescription: "山口県下関市で、機械を一切使わず国産素材にこだわり抜く『餃子屋はまだ』。職人の手包みだからこそ実現できる皮と具の絶妙な密着感と、焼き上げた際のジューシーさは感動ものです. 刺激的な「マーボー」、爽快な「大葉」、体が温まる「生姜」、スタミナ満点の「にんにく」という4つの個性が一箱に。", cooking: "水分が飛んだら少量の油で焼き色を。手包みの薄皮がパリッと仕上がります！", pairing: "キンキンに冷えた炭酸水、またはレモンサワー 🍋", sauce: "4種の味の違いをダイレクトに楽しむため、まずはタレなしで召し上がれ！", price: 7410, count: 48, tags: ["下関名物", "職人手包み"], color: "bg-orange-50", icon: "package", image: "https://imagedelivery.net/QondspN4HIUvB_R16-ddAQ/5f3da475d7e1d840cef4e6d5/575936aee4322829d163.png/fit=cover,w=920,h=920" },
            { id: 13, name: "長崎の色彩！『台湾料理 老李』彩り鮮やか・厳選5色水餃食べ尽くしセット", region: "九州地方", prefecture: "長崎", description: "長崎・新地中華街の名店。芳寿豚100%の肉汁が弾ける！しそ・とうもろこし・パクチー・海老, 目にも楽しい5色の贈り物。", longDescription: "長崎の美食家たちが集う『老李（ラオリー）』が贈る、究極の水餃子セット。最高級「長崎芳寿豚」を使用した餡は驚くほどの肉汁. 二度練りされた手作りの皮は滑らかな舌触りです。長崎の風を感じる、お祝いにぴったりの華やかな逸品です。", cooking: "凍ったまま投入。浮き上がってから数分、皮がぷっくりと膨らむまで茹でるのが『ぷりぷり食感』の正解！", pairing: "凍頂烏龍茶、または華やかな香りの台湾ビール 🍺", sauce: "老李特製のタレ、またはシンプルに黒酢だけで素材の香りを引き立てて。", price: 6579, count: 40, tags: ["長崎・中華街", "5色の彩り"], color: "bg-pink-50", icon: "palette", image: "https://www.otoriyose.net/upload/item/121/00012158/878b29dfc1714f9.jpg?ts=1751014808" },
            { id: 2, name: "別府のレジェンド！創業昭和22年『ぎょうざ専門店 湖月』極薄皮の芸術品セット", region: "九州地方", prefecture: "大分", description: "大分・別府で愛され続ける行列店. 一切の妥協なし、熟練の職人が手包みした『究極の薄皮』と肉の旨味が爆発。", longDescription: "昭和22年の創業以来、不動の人気を誇る伝説の専門店. 最大の特徴は、透けるほど薄く仕上げられた自家製の皮. 厳選素材のみを使用し、化学調味料を一切使わずに職人が手作りしています。外はカリッと、中はふっくらジューシー。", cooking: "多めの油で揚げ焼きにするのが湖月流！皮のパリパリ感を極限まで引き出し、中の肉汁を閉じ込めるのがポイントです。", pairing: "キンキンに冷えたビール、またはカボスを搾ったソーダ 🍹", sauce: "まずはタレなしで素材の甘みを。その次は酢多めの醤油ダレでさっぱりと。", price: 6290, count: 50, tags: ["創業昭和22年", "別府の誇り"], color: "bg-yellow-50", icon: "map", image: "https://baseec-img-mng.akamaized.net/images/item/origin/d1dd9492ac43737c751b6943407ad9cd.jpg?imformat=generic&q=90&im=Resize,width=1280,type=normal" }
        ];

        const ORDERED_ITEMS = [
            { id: 1, quantity: 1, status: 'shipping', arrivalDate: '2月2日(月) 到着予定' },
            { id: 14, quantity: 1, status: 'preparing', arrivalDate: '順次発送予定' },
            { id: 10, quantity: 1, status: 'delivered', arrivalDate: '1月28日 到着しました！' }
        ];

        const REGIONS = ["北海道地方", "東北地方", "関東地方", "北陸地方", "近畿地方", "中国地方", "九州地方"];
        let cart = {};

        // --- 初期描画 ---
        function init() {
            const raimon = document.getElementById('raimon-container');
            let raimonHtml = "";
            for(let i=0; i<15; i++) raimonHtml += '<span class="text-xl mx-2 flex items-center whitespace-nowrap text-white font-serif text-nowrap">回回回 <span class="mx-2 text-2xl">🍥</span> 回回回</span>';
            raimon.innerHTML = raimonHtml;
            render();
        }

        function render() {
            const app = document.getElementById('app-content');
            if (ORDER_COMPLETED) {
                renderHistoryMode(app);
            } else {
                renderSelectionMode(app);
            }
            if (window.lucide) window.lucide.createIcons();
        }

        // --- 1. 配送状況・履歴画面 ---
        function renderHistoryMode(container) {
            const orderedProducts = ORDERED_ITEMS.map(order => ({ ...GYOZA_DATA.find(p => p.id === order.id), ...order }));
            const totalOrderedCount = orderedProducts.reduce((sum, p) => sum + (p.count * p.quantity), 0);
            let currentStep = orderedProducts.every(p => p.status === 'delivered') ? 3 : (ORDER_STATUS === 'shipping' ? 2 : 1);
            
            container.innerHTML = `
              <div class="min-h-screen bg-[#ff4d4d] text-center relative selection:bg-yellow-400">
                <header class="px-6 py-12 relative z-10">
                  <div class="max-w-2xl mx-auto">
                    <div class="mb-12 flex justify-between items-center max-w-sm mx-auto relative">
                      <div class="absolute top-1/2 left-0 w-full h-1 bg-black/20 -translate-y-1/2 -z-10"></div>
                      <div class="absolute top-1/2 left-0 h-1 bg-yellow-400 -translate-y-1/2 -z-10 transition-all duration-1000" style="width: ${currentStep === 1 ? '0%' : currentStep === 2 ? '50%' : '100%'}"></div>
                      <div class="flex flex-col items-center gap-2"><div class="w-10 h-10 rounded-full border-4 border-black flex items-center justify-center font-black bg-yellow-400"><i data-lucide="check" size="20"></i></div><span class="text-[10px] font-black uppercase text-white bg-black px-2">受付完了</span></div>
                      <div class="flex flex-col items-center gap-2"><div class="w-10 h-10 rounded-full border-4 border-black flex items-center justify-center font-black ${currentStep >= 2 ? 'bg-yellow-400' : 'bg-white'}"><i data-lucide="truck" size="20"></i></div><span class="text-[10px] font-black uppercase ${currentStep >= 2 ? 'text-white bg-black' : 'text-slate-400 bg-slate-200'} px-2">配送中</span></div>
                      <div class="flex flex-col items-center gap-2"><div class="w-10 h-10 rounded-full border-4 border-black flex items-center justify-center font-black ${currentStep >= 3 ? 'bg-yellow-400 animate-bounce' : 'bg-white'}">${currentStep >= 3 ? '<i data-lucide="star" size="20" fill="currentColor"></i>' : 3}</div><span class="text-[10px] font-black uppercase ${currentStep >= 3 ? 'text-white bg-black' : 'text-slate-400 bg-slate-200'} px-2">到着！</span></div>
                    </div>
                    ${currentStep === 2 ? `
                        <div class="relative w-full h-44 overflow-hidden mb-4 select-none pointer-events-none">
                            <div class="absolute w-full h-[4px] bg-black/10 bottom-10"></div>
                            <div class="absolute flex flex-col items-center animate-delivery-run bottom-6">
                                <div class="relative w-48 h-32 flex items-end justify-center transform -scale-x-100">
                                    <img src="${DELIVERY_MAN_IMAGE}" class="max-w-full max-h-full object-contain drop-shadow-[6px_6px_0_rgba(0,0,0,0.3)]" />
                                    <div class="absolute -right-8 bottom-8 flex flex-col gap-2 opacity-60">
                                        <div class="w-10 h-1.5 bg-yellow-400 rounded-full animate-pulse"></div>
                                        <div class="w-14 h-1.5 bg-yellow-400 rounded-full animate-pulse delay-75"></div>
                                    </div>
                                </div>
                                <span class="text-[10px] font-black bg-black text-white px-3 py-1 rounded-full mt-2 border-2 border-yellow-400 shadow-xl italic">Gyoza Express</span>
                            </div>
                        </div>
                    ` : ''}
                    <div class="bg-yellow-400 w-28 h-28 rounded-full border-4 border-black flex items-center justify-center mx-auto mb-8 font-black text-6xl text-red-600 shadow-[8px_8px_0_0_rgba(0,0,0,1)]">福</div>
                    <h1 class="text-4xl md:text-6xl font-black text-white mb-4 drop-shadow-[4px_4px_0_rgba(0,0,0,1)] uppercase italic">${currentStep === 3 ? "ALL DELIVERED!" : "SHIPPING NOW!"}</h1>
                    <p class="text-xl font-bold text-yellow-300 drop-shadow-[2px_2px_0_rgba(0,0,0,1)] mb-8 max-w-lg mx-auto">${COMPLETED_MESSAGE}</p>
                    <div class="bg-white border-4 border-black p-4 rounded-2xl shadow-[6px_6px_0_0_rgba(0,0,0,1)] inline-flex items-center gap-3 transform -rotate-1"><i data-lucide="package" class="text-red-600"></i><span class="text-xl font-black">${DELIVERY_ESTIMATE}</span></div>
                  </div>
                </header>
                <main class="max-w-3xl mx-auto px-4 text-left relative z-10 pb-20">
                  <div class="bg-white border-4 border-black rounded-[3rem] p-8 shadow-[12px_12px_0_0_rgba(0,0,0,1)]">
                    <h2 class="text-2xl font-black mb-8 border-b-4 border-black pb-2 flex items-center gap-2 italic uppercase tracking-tighter"><i data-lucide="clock" class="text-red-600" /> History</h2>
                    <div class="space-y-6">
                      ${orderedProducts.map(item => `
                        <div class="group flex flex-col sm:flex-row gap-4 bg-slate-50 border-4 border-black p-5 rounded-[2.5rem] relative overflow-hidden transition-transform hover:scale-[1.01]">
                          <img src="${item.image}" class="w-full sm:w-24 h-24 rounded-2xl border-2 border-black object-cover" />
                          <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start mb-1"><div class="flex items-center gap-1 text-[10px] font-black text-slate-400 uppercase italic"><i data-lucide="map-pin" size="10"></i> ${item.prefecture}</div>
                                ${item.status === 'shipping' ? '<span class="bg-yellow-400 text-black text-[10px] px-2 font-black rounded border border-black animate-pulse">配送中</span>' : 
                                  item.status === 'delivered' ? '<span class="bg-red-600 text-white text-[10px] px-2 font-black rounded border border-black shadow-sm">到着済み</span>' : 
                                  '<span class="bg-slate-100 text-slate-400 text-[10px] px-2 font-black rounded border border-slate-300">発送待ち</span>'}
                            </div>
                            <p class="font-black text-slate-800 text-lg leading-tight italic">${item.name}</p>
                            <p class="text-xs font-bold text-red-600 mt-1 uppercase">${item.count} PCS × ${item.quantity}</p>
                            <p class="text-[11px] font-black text-slate-500 mt-2 bg-white border border-slate-200 px-2 py-1 rounded-full w-fit italic"><i data-lucide="clock" size="12" class="inline"></i> ${item.arrivalDate}</p>
                          </div>
                        </div>
                      `).join('')}
                    </div>
                    <div class="mt-10 bg-yellow-50 border-4 border-black border-dashed rounded-[2.5rem] p-6 text-center">
                        <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-1 italic">Capacity</p>
                        <p class="text-4xl font-black text-slate-800 italic uppercase">TOTAL ${totalOrderedCount} PCS</p>
                    </div>
                  </div>
                </main>
              </div>
            `;
        }

        // --- 2. ラインナップ選択画面 ---
        function renderSelectionMode(container) {
            let totalSpent = 0;
            Object.keys(cart).forEach(id => totalSpent += (GYOZA_DATA.find(p => p.id == id).price * cart[id]));

            let regionsHtml = "";
            REGIONS.forEach(region => {
                const items = GYOZA_DATA.filter(i => i.region === region);
                if (items.length === 0) return;
                regionsHtml += `
                    <section class="mb-20">
                      <div class="mb-8 relative inline-block">
                        <div class="absolute inset-0 bg-yellow-400 translate-x-2 translate-y-2 rounded-xl -z-10 border-4 border-black"></div>
                        <h2 class="bg-white border-4 border-black text-slate-900 px-8 py-3 rounded-xl font-black text-2xl italic flex items-center gap-3">★ ${region} ★</h2>
                      </div>
                      <div class="grid md:grid-cols-2 gap-10 text-left">
                        ${items.map(product => {
                            const qty = cart[product.id] || 0;
                            const canAdd = (totalSpent + product.price <= ACTUAL_LIMIT);
                            return `
                                <div class="bg-white border-4 border-black rounded-[2.5rem] shadow-[10px_10px_0_0_rgba(0,0,0,1)] overflow-hidden transition-all hover:-translate-y-1 ${qty > 0 ? 'ring-8 ring-yellow-400/40' : ''}">
                                    <div class="h-56 bg-slate-200 relative border-b-4 border-black overflow-hidden group">
                                        <div class="absolute top-4 right-4 z-10 bg-black/80 text-white text-[10px] px-2 py-1 rounded flex items-center gap-1 font-black shadow-md italic leading-none"><i data-lucide="map-pin" size={10} class="text-yellow-400"></i> ${product.prefecture}</div>
                                        <img src="${product.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" />
                                    </div>
                                    <div class="p-6">
                                        <div class="flex justify-between items-start mb-4">
                                            <h3 class="text-xl font-black mb-2 leading-tight italic flex-1 pr-2 break-words">${product.name}</h3>
                                            <div class="text-right flex-shrink-0 flex items-baseline gap-0.5"><span class="text-2xl font-black text-slate-900">${(product.price/100).toFixed(1)}</span><span class="text-[10px] font-black text-slate-500 italic">GP</span></div>
                                        </div>
                                        <p class="text-xs text-slate-600 mb-6 font-bold leading-relaxed break-words">${product.description}</p>
                                        <div class="flex justify-between items-center mb-6">
                                            <span class="bg-red-600 text-white px-3 py-1.5 rounded-lg border-2 border-black font-black text-[10px] uppercase shadow-[2px_2px_0_0_rgba(0,0,0,1)]">${product.count} PCS</span>
                                            <button onclick="showDetail(${product.id})" class="text-[10px] font-black bg-slate-100 border-2 border-black px-2 py-1 rounded-lg hover:bg-black hover:text-white transition-all flex items-center gap-1 active:translate-y-0.5"><i data-lucide="search" size="14"></i> 詳細を見る</button>
                                        </div>
                                        <div class="flex items-center justify-center bg-black rounded-3xl p-1.5 gap-6 border-2 border-white/20 shadow-inner">
                                            <button onclick="changeQty(${product.id}, -1)" class="w-12 h-12 bg-white border-2 border-black rounded-xl font-black active:scale-90">-</button>
                                            <span class="text-2xl font-black text-white italic">${qty}</span>
                                            <button onclick="changeQty(${product.id}, 1)" ${canAdd ? '' : 'disabled'} class="w-12 h-12 bg-yellow-400 border-2 border-black rounded-xl font-black active:scale-90">+</button>
                                        </div>
                                    </div>
                                </div>
                            `}).join('')}
                      </div>
                    </section>
                `;
            });

            container.innerHTML = `
              <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
                <div class="absolute top-[10%] left-[5%] text-6xl animate-bounce opacity-20" style="animation-duration: 3s">🐼</div>
                <div class="absolute top-[20%] right-[10%] text-7xl animate-bounce opacity-20" style="animation-duration: 5s">🍥</div>
                <div class="absolute top-[30%] left-[40%] text-[15rem] font-black text-white opacity-[0.03] rotate-12 select-none">福</div>
              </div>
              <header class="px-6 py-12 text-center relative z-10">
                <div class="max-w-2xl mx-auto">
                    <div class="inline-block relative mb-6">
                        <div class="absolute -top-10 -left-12 text-5xl animate-pulse rotate-[-15deg]">🐼</div>
                        <div class="absolute -top-10 -right-12 text-5xl animate-pulse rotate-[15deg]">🍥</div>
                        <div class="bg-yellow-400 w-24 h-24 rounded-full border-4 border-black flex items-center justify-center mx-auto mb-6 shadow-[6px_6px_0_0_rgba(0,0,0,1)] font-black text-5xl text-red-600">福</div>
                    </div>
                    <h1 class="text-5xl md:text-7xl font-black text-white mb-2 drop-shadow-[4px_4px_0_rgba(0,0,0,1)] uppercase italic tracking-tighter leading-none">Gyoza Feast!</h1>
                    <p class="text-xl md:text-2xl font-bold text-yellow-300 drop-shadow-[2px_2px_0_rgba(0,0,0,1)] mb-8">祝・入籍！好きなだけ選びなさい！</p>
                    <div class="bg-white border-4 border-black p-6 rounded-3xl shadow-[8px_8px_0_0_rgba(0,0,0,1)] inline-block transform -rotate-1">
                        <span class="text-[11px] font-black text-red-600 mb-1 block uppercase tracking-widest text-center italic">Your Selectable Power</span>
                        <div class="flex items-center justify-center gap-3"><span class="text-5xl font-black">150.0</span><p class="text-xl font-black italic leading-none">GP</p></div>
                    </div>
                </div>
              </header>
              <main class="max-w-4xl mx-auto px-4 py-8 relative z-10">${regionsHtml}</main>
              <div id="status-bar"></div>
            `;
            updateStatusBar();
        }

        // --- 3. ステータスバー更新 (🍥が動くバー) ---
        function updateStatusBar() {
            const barContainer = document.getElementById('status-bar');
            if(!barContainer) return;

            let totalSpent = 0;
            Object.keys(cart).forEach(id => totalSpent += (GYOZA_DATA.find(p => p.id == id).price * cart[id]));
            const currentGP = totalSpent / 100;
            const progressPercent = Math.min((currentGP / 150) * 100, 106.6);
            const isOver = currentGP > 150;

            barContainer.innerHTML = `
                <div class="fixed bottom-10 left-1/2 -translate-x-1/2 w-[95%] max-w-2xl z-50">
                    <div class="bg-white border-[5px] border-black rounded-[3rem] p-6 shadow-[12px_12px_0_0_rgba(0,0,0,1)] flex items-center justify-between gap-6 overflow-hidden">
                        <div class="flex flex-col flex-1 pl-4 relative text-left">
                            <div class="flex items-baseline gap-2">
                                <span class="text-[11px] font-black text-slate-400 uppercase italic tracking-widest leading-none">Power Status:</span>
                                <span class="text-4xl md:text-5xl font-black italic leading-none transition-colors ${isOver ? 'text-red-600' : 'text-slate-900'}">${currentGP.toFixed(1)}</span>
                                <span class="text-sm font-black text-slate-400 italic">/ 150.0</span>
                            </div>
                            <div class="h-5 w-full bg-slate-100 border-4 border-black rounded-full mt-3 relative shadow-inner overflow-visible">
                                <div class="h-full border-r-4 border-black transition-all duration-700 ease-out ${isOver ? 'bg-red-500' : 'bg-yellow-400'}" style="width: ${progressPercent}%"></div>
                                <div class="absolute top-0 text-lg transition-all duration-700 -translate-x-1/2 -translate-y-[2px]" style="left: ${progressPercent}%">🍥</div>
                            </div>
                            ${isOver ? '<div class="absolute -bottom-6 right-0 text-[10px] font-black text-red-600 animate-pulse uppercase italic">特別ボーナス！はみ出してもOKあるよ！ 🐼✨</div>' : ''}
                        </div>
                        <button onclick="showSummaryModal()" class="bg-red-600 text-white border-4 border-black px-10 py-5 rounded-[2rem] font-black text-2xl shadow-[6px_6px_0_0_rgba(0,0,0,1)] active:scale-95 transition-all">注文！ 🐼</button>
                    </div>
                </div>
            `;
        }

        // --- 4. アクション関数群 ---
        function changeQty(id, delta) {
            const current = cart[id] || 0;
            const next = current + delta;
            if(next < 0) return;

            let totalSpent = 0;
            Object.keys(cart).forEach(kid => totalSpent += (GYOZA_DATA.find(p => p.id == kid).price * (kid == id ? next : cart[kid])));

            if (delta > 0 && totalSpent > ACTUAL_LIMIT) {
                alert("パンダ：これ以上は予算オーバーあるよ！🐼");
                return;
            }

            cart[id] = next;
            render();
        }

        function showDetail(id) {
            const p = GYOZA_DATA.find(i => i.id === id);
            const overlay = document.createElement('div');
            overlay.id = "modal-overlay";
            overlay.className = "fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-in";
            overlay.onclick = closeModal;
            
            overlay.innerHTML = `
                <div class="bg-white border-4 border-black w-full max-w-xl rounded-[3rem] overflow-hidden relative shadow-2xl" onclick="event.stopPropagation()">
                    <button onclick="closeModal()" class="absolute top-6 right-6 w-12 h-12 bg-white border-2 border-black rounded-full font-black flex items-center justify-center z-20 shadow-xl">✕</button>
                    <div class="flex-1 overflow-y-auto custom-scrollbar pr-1">
                        <div class="h-64 bg-slate-200 relative border-b-4 border-black overflow-hidden">
                            <img src="${p.image}" class="w-full h-full object-cover" />
                            <div class="absolute bottom-4 left-4 flex flex-wrap gap-2">${p.tags.map(tag => `<span class="text-[10px] font-black bg-yellow-400 border-2 border-black px-3 py-1 rounded-full italic shadow-lg">#${tag}</span>`).join('')}</div>
                        </div>
                        <div class="p-8 text-left">
                            <div class="flex items-center gap-5 mb-8">
                                <div class="w-20 h-20 bg-yellow-50 rounded-[2rem] border-4 border-black flex items-center justify-center text-5xl shadow-[4px_4px_0_0_rgba(0,0,0,1)]">🥟</div>
                                <div class="flex-1"><h3 class="text-2xl font-black leading-tight italic tracking-tighter">${p.name}</h3><p class="text-sm font-black text-red-600 uppercase tracking-widest">${p.count} PIECES PACK</p></div>
                            </div>
                            <div class="space-y-8">
                                <div><p class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 italic">Masterpiece Story</p><p class="font-bold text-slate-700 leading-relaxed italic border-l-8 border-yellow-400 pl-6 bg-slate-50 py-5 rounded-r-[2rem] text-lg">"${p.longDescription}"</p></div>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div class="bg-slate-50 border-4 border-black p-4 rounded-[2rem]"><p class="text-[10px] font-black text-red-600 mb-1 uppercase italic"><i data-lucide="utensils" size="14" class="inline"></i> Pairing</p><p class="font-bold text-sm">${p.pairing}</p></div>
                                    <div class="bg-slate-50 border-4 border-black p-4 rounded-[2rem]"><p class="text-[10px] font-black text-blue-600 mb-1 uppercase italic">✨ Sauce</p><p class="font-bold text-sm">${p.sauce}</p></div>
                                </div>
                                <div class="bg-slate-900 text-white p-6 rounded-[2.5rem] relative shadow-xl"><p class="text-yellow-400 font-black text-xs mb-2 uppercase italic tracking-widest"><i data-lucide="flame" size="16" class="inline"></i> Master's Tip</p><p class="font-bold italic text-sm leading-relaxed">${p.cooking}</p></div>
                            </div>
                            <button onclick="closeModal()" class="w-full mt-10 bg-red-600 text-white py-5 rounded-[2rem] font-black text-xl border-4 border-black shadow-[6px_6px_0_0_rgba(0,0,0,1)] active:scale-95 transition-all">閉じるあるよ！</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            if (window.lucide) window.lucide.createIcons();
        }

        function showSummaryModal() {
            const activeIds = Object.keys(cart).filter(id => cart[id] > 0);
            if(activeIds.length === 0) return alert("まだ選んでないあるよ！🐼");
            
            let totalCount = 0;
            const itemsHtml = activeIds.map(id => {
                const p = GYOZA_DATA.find(i => i.id == id);
                totalCount += (p.count * cart[id]);
                return `
                    <div class="bg-white border-4 border-black p-5 rounded-[2rem] flex justify-between items-center shadow-md text-left transition-transform hover:scale-[1.03]">
                        <div class="min-w-0 flex-1 pr-4">
                            <p class="font-black text-slate-800 leading-tight text-lg italic mb-1 break-words">${p.name}</p>
                            <div class="text-[10px] font-black text-slate-400 uppercase italic"><i data-lucide="map-pin" size="8" class="inline"></i> ${p.prefecture}</div>
                        </div>
                        <div class="bg-slate-900 text-white px-5 py-2 rounded-2xl font-black text-2xl italic border-4 border-yellow-400 flex-shrink-0 shadow-lg min-w-[70px] text-center">x${cart[id]}</div>
                    </div>
                `;
            }).join('');

            const overlay = document.createElement('div');
            overlay.id = "modal-overlay";
            overlay.className = "fixed inset-0 bg-black/85 backdrop-blur-xl z-[110] flex items-center justify-center p-4 animate-in";
            overlay.onclick = closeModal;
            
            overlay.innerHTML = `
                <div class="bg-yellow-400 border-[8px] border-black w-full max-w-md rounded-[4rem] p-10 shadow-[20px_20px_0_0_rgba(255,77,77,1)] relative text-center" onclick="event.stopPropagation()">
                    <div class="mb-10"><div class="w-28 h-28 bg-white border-4 border-black rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl animate-bounce text-6xl font-black text-red-600">福</div><h3 class="text-5xl font-black italic uppercase leading-none">Perfect!</h3><p class="font-bold text-red-700 bg-white/70 inline-block px-6 py-1.5 rounded-full mt-3 border-4 border-red-700/20 shadow-sm">🐼 パンダも感動するセレクト！</p></div>
                    <div class="space-y-4 mb-10 max-h-64 overflow-y-auto pr-3 custom-scrollbar">${itemsHtml}</div>
                    <div class="bg-white border-4 border-black rounded-[2.5rem] p-6 mb-10 shadow-inner"><p class="text-xs font-black text-slate-400 uppercase mb-1 italic tracking-[0.3em]">Total Capacity</p><p class="text-4xl font-black text-slate-800 italic uppercase leading-none">TOTAL ${totalCount} PCS</p></div>
                    <button onclick="copyList(${totalCount})" id="copy-btn" class="w-full bg-red-600 text-white border-4 border-black py-6 rounded-[2.5rem] font-black text-2xl shadow-[8px_8px_0_0_rgba(0,0,0,1)] active:scale-95 uppercase">リストをコピー 🐼</button>
                    <button onclick="closeModal()" class="mt-6 font-black underline text-sm uppercase block mx-auto">選び直すあるよ！</button>
                </div>
            `;
            document.body.appendChild(overlay);
            if (window.lucide) window.lucide.createIcons();
        }

        function copyList(totalPcs) {
            let text = "【祝・入籍】餃子食べ尽くしギフトリスト🥟🍥🐼\n\n";
            Object.keys(cart).forEach(id => {
                if(cart[id] > 0) {
                    const p = GYOZA_DATA.find(i => i.id == id);
                    text += `・${p.name} (${p.count}個) × ${cart[id]}\n`;
                }
            });
            text += `\n計：${totalPcs}個の餃子パーティーセット！\nよろしくお願いします！`;
            navigator.clipboard.writeText(text);
            const btn = document.getElementById('copy-btn');
            btn.innerText = "コピー完了あるよ！ ✅";
            setTimeout(() => btn.innerText = "リストをコピー 🐼", 2000);
        }

        function closeModal() {
            const m = document.getElementById('modal-overlay');
            if(m) m.remove();
        }

        // --- 実行開始 ---
        init();
    </script>
</body>
</html>
